"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[4072],{26628:function(e,a,n){n.r(a),n.d(a,{_frontmatter:function(){return d},default:function(){return c}});var t=n(58168),i=n(80045),o=(n(88763),n(15680)),s=n(83407);const r=["components"],d={},m={_frontmatter:d},p=s.A;function c(e){let{components:a}=e,n=(0,i.A)(e,r);return(0,o.mdx)(p,(0,t.A)({},m,n,{components:a,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"firefly-expand-image-api-tutorial"},"Firefly Expand Image API Tutorial"),(0,o.mdx)("p",null,"Create multiple variations of an image by generating larger sizes of the image with the ",(0,o.mdx)("a",{parentName:"p",href:"../api/generative_expand/V3/"},"Expand Image API"),"."),(0,o.mdx)("p",null,(0,o.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"820px"}},"\n      ",(0,o.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"38.125%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,o.mdx)("picture",{parentName:"span"},"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/3cd317be755de6506f610e1e95a666c6/5530d/expand-image-tutorial-hero-image.webp 320w","/ff-services-docs/static/3cd317be755de6506f610e1e95a666c6/0c8fb/expand-image-tutorial-hero-image.webp 640w","/ff-services-docs/static/3cd317be755de6506f610e1e95a666c6/d9db4/expand-image-tutorial-hero-image.webp 820w"],sizes:"(max-width: 820px) 100vw, 820px",type:"image/webp"}),"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/3cd317be755de6506f610e1e95a666c6/dd4a7/expand-image-tutorial-hero-image.png 320w","/ff-services-docs/static/3cd317be755de6506f610e1e95a666c6/0f09e/expand-image-tutorial-hero-image.png 640w","/ff-services-docs/static/3cd317be755de6506f610e1e95a666c6/0bbcd/expand-image-tutorial-hero-image.png 820w"],sizes:"(max-width: 820px) 100vw, 820px",type:"image/png"}),"\n          ",(0,o.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/3cd317be755de6506f610e1e95a666c6/0bbcd/expand-image-tutorial-hero-image.png",alt:"shoes advertisement hero image",title:"shoes advertisement hero image",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,o.mdx)("h2",{id:"overview"},"Overview"),(0,o.mdx)("p",null,"For this tutorial, imagine we are working on a marketing campaign at a Fortune 100 company, and we need to create different sized images variations optimized for various social media platforms. In the past, we had to manually resize images for each platform, which was time-consuming and error-prone. With Firefly's Expand Image API, we automate this process and generate multiple variations of an images with dimensions optimized for platforms like Instagram, Facebook, Twitter, and more."),(0,o.mdx)("p",null,"Before diving into the code, let's preview the high-level steps:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("strong",{parentName:"li"},"Define Target Dimensions:")," Each social media platform has specific image size requirements. We define these dimensions for the platforms you target."),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("strong",{parentName:"li"},"Upload Source Image:")," Use Firefly's ",(0,o.mdx)("a",{parentName:"li",href:"../api/upload_image/"},"Upload API")," to upload your original image."),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("strong",{parentName:"li"},"Generate Variations:")," Use Firefly's ",(0,o.mdx)("a",{parentName:"li",href:"../api/generative_expand/V3/"},"Expand Image API")," to create resized variations of the image for each dimension.")),(0,o.mdx)("p",null,"Depending on your learning style, you may prefer to walk through this tutorial step-by-step or ",(0,o.mdx)("a",{parentName:"p",href:"#full-example"},"go straight to the full source code"),"."),(0,o.mdx)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.mdx)("p",null,"This tutorial assumes you worked with your Adobe Representative and have the following:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"An ",(0,o.mdx)("a",{parentName:"li",href:"https://developer.adobe.com/console/786177/home"},"Adobe Developer Console")," account."),(0,o.mdx)("li",{parentName:"ul"},"A ",(0,o.mdx)("a",{parentName:"li",href:"https://developer.adobe.com/developer-console/docs/guides/projects/projects-empty/"},"Adobe Developer Console project")," with Firefly API ",(0,o.mdx)("a",{parentName:"li",href:"https://developer.adobe.com/developer-console/docs/guides/services/services-add-api-oauth-s2s/"},"OAuth Server-to-Server credentials set up"),"."),(0,o.mdx)("li",{parentName:"ul"},"Access to your Client ID and Client Secret from the ",(0,o.mdx)("a",{parentName:"li",href:"https://developer.adobe.com/developer-console/docs/guides/services/services-add-api-oauth-s2s/#api-overview"},"Adobe Developer Console project"),". Securely store these credentials and never expose them in client-side or public code.")),(0,o.mdx)("p",null,"Before we begin this tutorial, if you don't already have it, set up ",(0,o.mdx)("a",{parentName:"p",href:"https://nodejs.org/en/download/package-manager"},"Node.js"),". Run the following in a secure terminal:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"export FIREFLY_CLIENT_ID=yourClientIdAsdf123\nexport FIREFLY_CLIENT_SECRET=yourClientSecretAsdf123\n\nmkdir firefly-expand-image-api-tutorial\ncd firefly-expand-image-api-tutorial\nnpm init --y\nnpm install axios qs\ntouch index.js\n")),(0,o.mdx)("h2",{id:"download-sample-image"},"Download Sample Image"),(0,o.mdx)("p",null,"Save this sample image to your project folder:"),(0,o.mdx)("p",null,(0,o.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,o.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"128.43749999999997%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,o.mdx)("picture",{parentName:"span"},"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/340246f266c901b4dc7b3cd82beaab1a/5530d/expand-image-tutorial-source-image.webp 320w","/ff-services-docs/static/340246f266c901b4dc7b3cd82beaab1a/0c8fb/expand-image-tutorial-source-image.webp 640w","/ff-services-docs/static/340246f266c901b4dc7b3cd82beaab1a/94b1e/expand-image-tutorial-source-image.webp 1280w","/ff-services-docs/static/340246f266c901b4dc7b3cd82beaab1a/a4772/expand-image-tutorial-source-image.webp 1792w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/340246f266c901b4dc7b3cd82beaab1a/dd4a7/expand-image-tutorial-source-image.png 320w","/ff-services-docs/static/340246f266c901b4dc7b3cd82beaab1a/0f09e/expand-image-tutorial-source-image.png 640w","/ff-services-docs/static/340246f266c901b4dc7b3cd82beaab1a/bbbf7/expand-image-tutorial-source-image.png 1280w","/ff-services-docs/static/340246f266c901b4dc7b3cd82beaab1a/445c6/expand-image-tutorial-source-image.png 1792w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,o.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/340246f266c901b4dc7b3cd82beaab1a/bbbf7/expand-image-tutorial-source-image.png",alt:"expand-image-tutorial-source-image.webp",title:"expand-image-tutorial-source-image.webp",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,o.mdx)("h2",{id:"define-dimensions"},"Define Dimensions"),(0,o.mdx)("p",null,"First, let's define the image dimensions for each social media platform:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"const SOCIAL_MEDIA_PLATFORMS = [\n  {\n    name: 'Instagram Post',\n    width: 1080,\n    height: 1080,\n  },\n  {\n    name: 'Facebook Cover',\n    width: 820,\n    height: 312,\n  },\n  {\n    name: 'Twitter Post',\n    width: 1024,\n    height: 512,\n  }\n];\n")),(0,o.mdx)("h2",{id:"upload-source-image"},"Upload Source Image"),(0,o.mdx)("p",null," Next, let's upload our source image using Firefly's ",(0,o.mdx)("a",{parentName:"p",href:"../api/upload_image/"},"Upload API"),". This image serves as the starting point for all variations."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"const axios = require(\"axios\");\nconst fs = require('fs');\n\nasync function uploadImage({ filePath, fileType, accessToken }) {\n  let stream = fs.createReadStream(filePath);\n  let stats = fs.statSync(filePath);\n  let fileSizeInBytes = stats.size;\n\n  const config = {\n    method: 'post',\n    url: 'https://firefly-api.adobe.io/v2/storage/image',\n    headers: {\n      'Authorization': `Bearer ${accessToken}`,\n      'X-API-Key': process.env.FIREFLY_CLIENT_ID,\n      'Content-Type': fileType,\n      'Content-Length': fileSizeInBytes,\n    },\n    data: fileStream,\n    maxContentLength: Infinity,\n    maxBodyLength: Infinity,\n  };\n\n  const response = await axios(config);\n  return response.data;\n}\n")),(0,o.mdx)("p",null,"On success, the response looks similar to this:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "images":\n    [\n      {\n        "id": "510aabb4-e154-4a7b-bd2e-f492ee71c938" \n    }\n  ]\n}\n')),(0,o.mdx)("h2",{id:"generate-image-variations"},"Generate Image Variations"),(0,o.mdx)("p",null,"Next, let's create a function that generates images for each social media platform with Firefly's ",(0,o.mdx)("a",{parentName:"p",href:"../api/generative_expand/V3/"},"Expand Image API"),". We use the ",(0,o.mdx)("inlineCode",{parentName:"p"},"axios")," library to make HTTPs requests:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"const axios = require('axios');\n\nasync function genExpand({ imageId, width, height, accessToken }) {\n  const body = {\n    size: { width, height },\n    image: { \n      source: { uploadId: imageId }\n    }\n  }\n\n  const config = {\n    method: 'post',\n    url: 'https://firefly-api.adobe.io/v3/images/expand',\n    headers: {\n      'X-Api-Key': process.env.FIREFLY_CLIENT_ID,\n      'Authorization': `Bearer ${accessToken}`,\n      'Content-Type': 'application/json',\n    },\n    data: JSON.stringify(body),\n  };\n\n  const response = await axios(config);\n  return response.data;\n}\n")),(0,o.mdx)("p",null,"We can expand the image to fit each social media platform's optimized dimensions and log the URL of the generated image:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"async function createSocialMediaRenditions(accessToken) {\n  // Upload the source image\n  let upload = await uploadImage('./expand-image-tutorial-source-image.webp', 'image/webp', accessToken);\n  let sourceImageId = upload.images[0].id;\n\n  // Iterate over each platform and generate renditions\n  for (let platform of SOCIAL_MEDIA_PLATFORMS) {\n    let result = await genExpand(\n      sourceImageId,\n      platform.width,\n      platform.height,\n      accessToken\n    );\n\n    console.log(`Generated image variation for ${platform.name} at ${result.outputs[0].image.url}`);\n  }\n}\n")),(0,o.mdx)("p",null,"Once we know Firefly generated our images, we log the results, including the URL for each generated images."),(0,o.mdx)("h2",{id:"full-example"},"Full Example"),(0,o.mdx)("p",null,"You can review the ",(0,o.mdx)("a",{parentName:"p",href:"#prerequisites"},"Prequisites")," section to understand how to set up your environment prior to running this code. Note that this is an example only ad is not production-ready and requires additional error handling, logging, security measures, and more before you can run it at scale in a live application."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},'const axios = require("axios");\nconst qs = require("qs");\nconst fs = require("fs");\n\n// Define social media platforms and their image dimensions\nconst SOCIAL_MEDIA_PLATFORMS = [\n  {\n    name: "Instagram Post",\n    width: 1080,\n    height: 1080,\n  },\n  {\n    name: "Facebook Cover",\n    width: 820,\n    height: 312,\n  },\n  {\n    name: "Twitter Post",\n    width: 1024,\n    height: 512,\n  },\n];\n\n(async () => {\n  const accessToken = await retrieveAccessToken();\n  await createSocialMediaRenditions(accessToken);\n})();\n\nasync function retrieveAccessToken() {\n  let data = qs.stringify({\n    grant_type: "client_credentials",\n    client_id: process.env.FIREFLY_CLIENT_ID,\n    client_secret: process.env.FIREFLY_CLIENT_SECRET,\n    scope:\n      "openid,AdobeID,session,additional_info,read_organizations,firefly_api,ff_apis",\n  });\n\n  let config = {\n    method: "post",\n    maxBodyLength: Infinity,\n    url: "https://ims-na1.adobelogin.com/ims/token/v3",\n    headers: {\n      "Content-Type": "application/x-www-form-urlencoded",\n    },\n    data: data,\n  };\n\n  try {\n    const response = await axios.request(config);\n    const { access_token } = response.data;\n    return access_token;\n  } catch (error) {\n    console.log(error);\n  }\n}\n\nasync function uploadImage({ filePath, fileType, accessToken }) {\n  const fileStream = fs.createReadStream(filePath);\n  const fileStats = fs.statSync(filePath);\n  const fileSizeInBytes = fileStats.size;\n\n  const config = {\n    method: "post",\n    url: "https://firefly-api.adobe.io/v2/storage/image",\n    headers: {\n      Authorization: `Bearer ${accessToken}`,\n      "X-API-Key": process.env.FIREFLY_CLIENT_ID,\n      "Content-Type": fileType,\n      "Content-Length": fileSizeInBytes,\n    },\n    data: fileStream,\n    maxContentLength: Infinity,\n    maxBodyLength: Infinity,\n  };\n\n  const response = await axios(config);\n  return response.data;\n}\n\nasync function genExpand({ imageId, width, height, accessToken }) {\n  const body = {\n    numVariations: 1,\n    size: {\n      width,\n      height,\n    },\n    image: {\n      source: {\n        uploadId: imageId,\n      },\n    },\n  };\n\n  const config = {\n    method: "post",\n    url: "https://firefly-api.adobe.io/v3/images/expand",\n    headers: {\n      "X-Api-Key": process.env.FIREFLY_CLIENT_ID,\n      Authorization: `Bearer ${accessToken}`,\n      "Content-Type": "application/json",\n    },\n    data: body,\n  };\n\n  const response = await axios(config);\n  return response.data;\n}\n\nasync function createSocialMediaRenditions(accessToken) {\n  // Upload the source image\n  let upload = await uploadImage({\n    filePath: "./source-image.webp",\n    fileType: "image/webp",\n    accessToken,\n  });\n\n  let sourceImageId = upload.images[0].id;\n\n  // Loop over each platform and generate renditions\n  for (const platform of SOCIAL_MEDIA_PLATFORMS) {\n    let result = await genExpand({\n      imageId: sourceImageId,\n      width: platform.width,\n      height: platform.height,\n      accessToken,\n    });\n\n    console.log(\n      `Generated rendition for ${platform.name} at ${result.outputs[0].image.url}`,\n    );\n  }\n}\n')),(0,o.mdx)("p",null,"This tutorial uses the CommmonJS convention in order to make it easy to get up and running with the code. If you'd prefer the ES6 modules, you can easily convert the code by changing the ",(0,o.mdx)("inlineCode",{parentName:"p"},"require")," statements to ",(0,o.mdx)("inlineCode",{parentName:"p"},"import")," statements and then changing the file name from ",(0,o.mdx)("inlineCode",{parentName:"p"},"index.js")," to ",(0,o.mdx)("inlineCode",{parentName:"p"},"index.mjs"),"."),(0,o.mdx)("h2",{id:"learn-more"},"Learn More"),(0,o.mdx)("p",null,"Now that you completed this tutorial, visit its ",(0,o.mdx)("a",{parentName:"p",href:"../api/generative_expand/V3"},"API Reference")," to explore more advanced use cases to automate image generation with Firefly."))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-firefly-api-guides-how-tos-firefly-expand-image-api-tutorial-md-4317fba08213e9520640.js.map