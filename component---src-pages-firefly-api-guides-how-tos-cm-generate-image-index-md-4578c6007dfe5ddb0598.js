"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[6883],{2737:function(e,n,t){t.r(n),t.d(n,{_frontmatter:function(){return l},default:function(){return g}});var s=t(58168),a=t(80045),o=(t(88763),t(15680)),r=t(83407);const i=["components"],l={},c=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.mdx)("div",n)},d=c("CodeBlock"),p=c("InlineAlert"),m={_frontmatter:l},u=r.A;function g(e){let{components:n}=e,t=(0,a.A)(e,i);return(0,o.mdx)(u,(0,s.A)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"custom-models-generate-image-api-tutorial"},"Custom Models Generate Image API Tutorial"),(0,o.mdx)("p",null,"Learn to generate images using a Firefly Custom Model."),(0,o.mdx)("table",null,(0,o.mdx)("thead",{parentName:"table"},(0,o.mdx)("tr",{parentName:"thead"},(0,o.mdx)("th",{parentName:"tr",align:null}),(0,o.mdx)("th",{parentName:"tr",align:null}))),(0,o.mdx)("tbody",{parentName:"table"},(0,o.mdx)("tr",{parentName:"tbody"},(0,o.mdx)("td",{parentName:"tr",align:null},(0,o.mdx)("span",{parentName:"td",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,o.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"70.625%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,o.mdx)("picture",{parentName:"span"},"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/4c5b230fe14fb1fd857971010e8a04fb/5530d/customModelTrained.webp 320w","/ff-services-docs/static/4c5b230fe14fb1fd857971010e8a04fb/0c8fb/customModelTrained.webp 640w","/ff-services-docs/static/4c5b230fe14fb1fd857971010e8a04fb/94b1e/customModelTrained.webp 1280w","/ff-services-docs/static/4c5b230fe14fb1fd857971010e8a04fb/e3f3a/customModelTrained.webp 1854w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/4c5b230fe14fb1fd857971010e8a04fb/dd4a7/customModelTrained.png 320w","/ff-services-docs/static/4c5b230fe14fb1fd857971010e8a04fb/0f09e/customModelTrained.png 640w","/ff-services-docs/static/4c5b230fe14fb1fd857971010e8a04fb/bbbf7/customModelTrained.png 1280w","/ff-services-docs/static/4c5b230fe14fb1fd857971010e8a04fb/b7708/customModelTrained.png 1854w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,o.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/4c5b230fe14fb1fd857971010e8a04fb/bbbf7/customModelTrained.png",alt:"trained-custom-model",title:"trained-custom-model",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")," ",(0,o.mdx)("p",{style:{textAlign:"center"}},"Custom Image Model")),(0,o.mdx)("td",{parentName:"tr",align:null},(0,o.mdx)("span",{parentName:"td",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,o.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"73.125%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,o.mdx)("picture",{parentName:"span"},"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/7b16fc09386a82cebf81d4c2d8e357e2/5530d/almond.webp 320w","/ff-services-docs/static/7b16fc09386a82cebf81d4c2d8e357e2/0c8fb/almond.webp 640w","/ff-services-docs/static/7b16fc09386a82cebf81d4c2d8e357e2/94b1e/almond.webp 1280w","/ff-services-docs/static/7b16fc09386a82cebf81d4c2d8e357e2/a111e/almond.webp 1614w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,o.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/7b16fc09386a82cebf81d4c2d8e357e2/dd4a7/almond.png 320w","/ff-services-docs/static/7b16fc09386a82cebf81d4c2d8e357e2/0f09e/almond.png 640w","/ff-services-docs/static/7b16fc09386a82cebf81d4c2d8e357e2/bbbf7/almond.png 1280w","/ff-services-docs/static/7b16fc09386a82cebf81d4c2d8e357e2/0914b/almond.png 1614w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,o.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/7b16fc09386a82cebf81d4c2d8e357e2/bbbf7/almond.png",alt:"generated-image",title:"generated-image",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")," ",(0,o.mdx)("p",{style:{textAlign:"center"}},"Output Image"))))),(0,o.mdx)("h2",{id:"overview"},"Overview"),(0,o.mdx)("p",null,"In this tutorial you will:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"List custom models that are available."),(0,o.mdx)("li",{parentName:"ul"},"Generate images using a specific custom model, with the custom parameters: prompt, style presets, and image size.")),(0,o.mdx)("p",null,"Depending on your learning style, you may prefer to walk through this tutorial step-by-step or ",(0,o.mdx)("a",{parentName:"p",href:"#implementation-example"},"jump immediately to the full source code")," at the bottom of this webpage."),(0,o.mdx)("h2",{id:"introduction"},"Introduction"),(0,o.mdx)("p",null,"Imagine you work at a global fragrance company and are creating an on-brand marketing campaign. This season introduced a new fad in the world of scent: almonds. The people want almond candles, almond soap, almond scrubs, and almond perfume. There's almond in every product in the new line. The pitch for this new trend with legumes is they're clean, natural, and (somehow) cozy, and comfortable."),(0,o.mdx)("p",null,"So, let's make some images."),(0,o.mdx)("h2",{id:"getting-started"},"Getting started"),(0,o.mdx)("h3",{id:"credentials"},"Credentials"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Retrieve a Firefly Services ",(0,o.mdx)("strong",{parentName:"li"},"Client ID")," and ",(0,o.mdx)("strong",{parentName:"li"},"Client Secret")," from your ",(0,o.mdx)("a",{parentName:"li",href:"https://developer.adobe.com/developer-console/docs/guides/services/services-add-api-oauth-s2s/#api-overview"},"Adobe Developer Console project"),". ",(0,o.mdx)("strong",{parentName:"li"},"Securely store these credentials and never expose them in client-side or public code."))),(0,o.mdx)("h3",{id:"set-up-your-environment"},"Set up your environment"),(0,o.mdx)("p",null,"Along with the cURL commands, this tutorial offers code samples in JavaScript and Python."),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Set up an environment by running the following in a secure terminal:")),(0,o.mdx)(d,{slots:"heading, code",repeat:"2",languages:"Python, JavaScript",mdxType:"CodeBlock"}),(0,o.mdx)("p",null,"JavaScript"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"mkdir cm-generate-image-api-tutorial\ncd cm-generate-image-api-tutorial\nnpm init --y\nnpm install axios qs\ntouch index.js\n")),(0,o.mdx)("p",null,"Python"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"mkdir cm-generate-image-api-tutorial\ncd cm-generate-image-api-tutorial\npython -m pip install requests\ntouch main.py\n")),(0,o.mdx)("h3",{id:"retrieve-an-access-token"},"Retrieve an access token"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Open a secure terminal and ",(0,o.mdx)("inlineCode",{parentName:"li"},"export")," your Client ID and Client Secret as environment variables to use later.")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"export CUSTOM_MODELS_CLIENT_ID=<yourClientId>\nexport CUSTOM_MODELS_CLIENT_SECRET=<yourClientSecret>\n")),(0,o.mdx)("ol",{start:2},(0,o.mdx)("li",{parentName:"ol"},"Generate an access token.")),(0,o.mdx)(d,{slots:"heading, code",repeat:"3",languages:"bash, Python, JavaScript",mdxType:"CodeBlock"}),(0,o.mdx)("h4",{id:"curl"},"cURL"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"curl --location 'https://ims-na1.adobelogin.com/ims/token/v3' \\\n--header 'Content-Type: application/x-www-form-urlencoded' \\\n--data-urlencode 'grant_type=client_credentials' \\\n--data-urlencode \"client_id=$CUSTOM_MODELS_CLIENT_ID\" \\\n--data-urlencode \"client_secret=$CUSTOM_MODELS_CLIENT_SECRET\" \\\n--data-urlencode 'scope=openid,AdobeID,firefly_api,ff_apis'\n")),(0,o.mdx)("h4",{id:"python"},"Python"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-python"},"def retrieve_access_token():\n    client_id = os.environ['CUSTOM_MODELS_CLIENT_ID']\n    client_secret = os.environ['CUSTOM_MODELS_CLIENT_SECRET']\n\n    token_url = 'https://ims-na1.adobelogin.com/ims/token/v3'\n    payload = {\n        'grant_type': 'client_credentials',\n        'client_id': client_id,\n        'client_secret': client_secret,\n        'scope': 'openid,AdobeID,firefly_api,ff_apis'\n    }\n\n    response = requests.post(token_url, data=payload)\n    response.raise_for_status()\n    token_data = response.json()\n    print(\"Access Token Retrieved\")\n    return token_data['access_token']\n")),(0,o.mdx)("h4",{id:"javascript"},"JavaScript"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"async function retrieveAccessToken() {\n  const data = qs.stringify({\n    grant_type: 'client_credentials',\n    client_id: process.env.CUSTOM_MODELS_CLIENT_ID,\n    client_secret: process.env.CUSTOM_MODELS_CLIENT_SECRET,\n    scope: 'openid,AdobeID,firefly_api,ff_apis',\n  });\n\n  const config = {\n    method: 'post',\n    url: 'https://ims-na1.adobelogin.com/ims/token/v3',\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },\n    data: data,\n  };\n\n  try {\n    const response = await axios.request(config);\n    console.log('Access Token Retrieved');\n    return response.data.access_token;\n  } catch (error) {\n    console.error('Error retrieving access token:', error.response.data);\n  }\n}\n")),(0,o.mdx)("p",null,"The response will look like this:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'{"access_token":"yourAccessTokenAsdf123","token_type":"bearer","expires_in":86399}\n')),(0,o.mdx)("ol",{start:3},(0,o.mdx)("li",{parentName:"ol"},"Export the access token to use later.")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"export CUSTOM_MODELS_ACCESS_TOKEN=<yourAccessToken>\n")),(0,o.mdx)("h2",{id:"find-a-custom-model"},"Find a custom model"),(0,o.mdx)("p",null,"Remember those pitch requirements? Clean, natural, cozy, and comfortable. So, all the images for our campaign should align with these characteristics."),(0,o.mdx)("p",null,"Do we have a custom model suitable for that? Let's check."),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"List all the available models by calling the endpoint below.")),(0,o.mdx)(d,{slots:"heading, code",repeat:"3",languages:"bash, Python, JavaScript",mdxType:"CodeBlock"}),(0,o.mdx)("p",null,"cURL"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"curl --request GET 'https://firefly-api.adobe.io/v3/custom-models' \\\n--header 'Content-Type: application/json' \\\n--header 'Accept: application/json' \\\n--header \"x-api-key: $CUSTOM_MODELS_CLIENT_ID\" \\\n--header \"Authorization: Bearer $CUSTOM_MODELS_ACCESS_TOKEN\"\n")),(0,o.mdx)("p",null,"Python"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-python"},"def list_custom_models(access_token):\n    headers = {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        'x-api-key': os.environ['CUSTOM_MODELS_CLIENT_ID'],\n        'Authorization': f'Bearer {access_token}'\n    }\n\n    response = requests.get(\n        'https://firefly-api.adobe.io/v3/custom-models',\n        headers=headers\n    )\n    response.raise_for_status()\n    models_response = response.json()\n    print(\"List Custom Models Response:\", models_response)\n    return models_response\n")),(0,o.mdx)("p",null,"JavaScript"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},'async function listCustomModels(accessToken) {\n  const headers = {\n    "Content-Type": "application/json",\n    Accept: "application/json",\n    "x-api-key": process.env.CUSTOM_MODELS_CLIENT_ID,\n    Authorization: `Bearer ${accessToken}`,\n  };\n\n  const config = {\n    method: "get",\n    url: "https://firefly-api.adobe.io/v3/custom-models",\n    headers: headers,\n  };\n\n  try {\n    const response = await axios.request(config);\n    console.log("List Custom Models Response:", response.data);\n    return response.data;\n  } catch (error) {\n    console.error("Error during listCustomModels:", error);\n  }\n}\n')),(0,o.mdx)("p",null,"The response will look like this:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'{\n    "custom_models": [\n        {\n            "version": "1",\n            "assetName": "Warm Custom Model.ffcustommodel",\n            "size": 16513991265,\n            "etag": "\\"e7ee78220f4d46ceb766758e0e300a51\\"",\n            "trainingMode": "style",\n            "assetId": "urn:aaid:sc:VA6C2:bc1f46cd-be98-4a7b-9ffe-1111111111",\n            "mediaType": "application/vnd.adobe.ffmodel+dcx",\n            "createdDate": 1733928288871,\n            "modifiedDate": 1733928294741,\n            "publishedState": "published",\n            "baseModel": {\n                "name": "clio_v2",\n                "version": "2.0.0"\n            },\n            "samplePrompt": "A bean generated in a warm setting with brown colours",\n            "displayName": "Warm Custom Model",\n            "conceptId": ""\n        }\n    ],\n    "_links": {\n        "page": {\n            "href": "/v3/custom-models?start={start}&limit={limit}",\n            "rel": "page",\n            "templated": true\n        }\n    },\n    "total_count": 1\n}\n')),(0,o.mdx)("p",null,"It looks like we have a suitable model, a Warm Custom Model! Let's choose this model to generate our images."),(0,o.mdx)("ol",{start:2},(0,o.mdx)("li",{parentName:"ol"},"To use a custom model, you'll need the custom model ID. Find the custom model ID in the response object, labeled ",(0,o.mdx)("inlineCode",{parentName:"li"},"assetId"),"."),(0,o.mdx)("li",{parentName:"ol"},"Export this ID for use later.")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"export CUSTOM_MODEL_ID=urn:aaid:sc:VA6C2:bc1f46cd-be98-4a7b-9ffe-1111111111\n")),(0,o.mdx)("h2",{id:"generate-your-images"},"Generate your images"),(0,o.mdx)("p",null,"Time to put the AI to work. Let's use the Custom Model ID to generate images with our custom model!"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Use Firefly's Generate Image API to generate product images. With our custom model to consider, include the header ",(0,o.mdx)("inlineCode",{parentName:"li"},"x-model-version: image3_custom")," in your request, as this tells the system to use our custom model for image generation.")),(0,o.mdx)(d,{slots:"heading, code",repeat:"3",languages:"bash, Python, JavaScript",mdxType:"CodeBlock"}),(0,o.mdx)("p",null,"cURL"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},'curl --request POST \'https://firefly-api.adobe.io/v3/images/generate-async\' \\\n--header \'Content-Type: application/json\' \\\n--header \'Accept: application/json\' \\\n--header \'x-accept-mimetype: image/jpeg\' \\\n--header \'x-model-version: image3_custom\' \\\n--header "x-api-key: $CUSTOM_MODELS_CLIENT_ID" \\\n--header "Authorization: Bearer $CUSTOM_MODELS_ACCESS_TOKEN" \\\n--data "{\n    \\"numVariations\\": 2,\n    \\"seeds\\": [66080, 82683],\n    \\"size\\": {\\"width\\": 2048,\\"height\\": 2048},\n    \\"prompt\\": \\"An almond seed in a warm setting\\",\n    \\"contentClass\\": \\"photo\\",\n    \\"visualIntensity\\": 6,\n    \\"style\\": {\n        \\"presets\\": [\\"painting\\"],\n        \\"strength\\": 50\n    },\n    \\"promptBiasingLocaleCode\\": \\"en-US\\",\n    \\"customModelId\\": \\"$CUSTOM_MODEL_ID\\"\n  }"\n')),(0,o.mdx)("p",null,"Python"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-python"},'def generate_images_with_custom_model(access_token, custom_model_id):\n    url = \'https://firefly-api.adobe.io/v3/images/generate-async\'\n    headers = {\n        \'Accept\': \'application/json\',\n        \'Authorization\': f\'Bearer {access_token}\',\n        \'Content-Type\': \'application/json\',\n        \'x-accept-mimetype\': \'image/jpeg\',\n        \'x-model-version\':\'image3_custom\',\n        \'x-api-key\': os.environ[\'CUSTOM_MODELS_CLIENT_ID\'],\n    }\n\n    data = {\n        "numVariations": 2,\n        "seeds": [66080, 82683],\n        "size": {"width": 2048, "height": 2048},\n        "prompt": "An almond seed in a warm setting",\n        "contentClass": "photo",\n        "visualIntensity": 6,\n        "style": {\n            "presets": ["painting"],\n            "strength": 50\n        },\n        "promptBiasingLocaleCode": "en-US",\n        "customModelId": custom_model_id\n    }\n\n    response = requests.post(url, headers=headers, json=data)\n    response.raise_for_status()\n    result = response.json()\n    print("Generate Image Response:", result)\n    return result\n\n')),(0,o.mdx)("p",null,"JavaScript"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},'async function generateImagesWithCustomModel(accessToken, customModelId) {\n  const config = {\n    method: "post",\n    url: "https://firefly-api.adobe.io/v3/images/generate-async",\n    headers: {\n      "Accept": "application/json",\n      "Authorization": `Bearer ${accessToken}`,\n      "Content-Type": "application/json",\n      "x-accept-mimetype": "image/jpeg",\n      "x-model-version":"image3_custom",\n      "x-api-key": process.env.CUSTOM_MODELS_CLIENT_ID,\n    },\n    data: JSON.stringify({\n      "numVariations": 2,\n      "seeds": [66080, 82683],\n      "size": { "width": 2048, "height": 2048 },\n      "prompt": "An almond seed in a warm setting",\n      "contentClass": "photo",\n      "visualIntensity": 6,\n      "style": {\n        "presets": ["painting"],\n        "strength": 50\n      },\n      "promptBiasingLocaleCode": "en-US",\n      "customModelId": customModelId\n    })\n  };\n\n  const response = await axios.request(config);\n  return response.data;\n}\n')),(0,o.mdx)("p",null,"The response will look something like this:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "jobId": "urn:ff:jobs:EXAMPLE85125:2dc3bd5f-1606-4658-8781-111111111",\n  "statusUrl": "https://firefly-epo852211.adobe.io/v3/status/urn:ff:jobs:EXAMPLE85125:2dc3bd5f-1606-4658-8781-111111111",\n  "cancelUrl": "https://firefly-epo852211.adobe.io/v3/cancel/urn:ff:jobs:EXAMPLE85125:2dc3bd5f-1606-4658-8781-111111111"\n} \n')),(0,o.mdx)("h3",{id:"check-the-image-generation-status"},"Check the image generation status"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Use the Get Status endpoint to get the image generation job status. Here is an example of how to do this.")),(0,o.mdx)(d,{slots:"heading, code",repeat:"3",languages:"bash, Python, JavaScript",mdxType:"CodeBlock"}),(0,o.mdx)("p",null,"cURL"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"curl --location 'https://firefly-epo852211.adobe.io/v3/status/urn:ff:jobs:EXAMPLE85125:2dc3bd5f-1606-4658-8781-111111111' \\\n--header 'Content-Type: application/json' \\\n--header 'Accept: application/json' \\\n--header \"x-api-key: $CUSTOM_MODELS_CLIENT_ID\" \\\n--header \"Authorization: Bearer $CUSTOM_MODELS_ACCESS_TOKEN\" \n")),(0,o.mdx)("p",null,"Python"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-python"},"def check_job_status(status_url, access_token):\n    headers = {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        'x-api-key': os.environ['CUSTOM_MODELS_CLIENT_ID'],\n        'Authorization': f'Bearer {access_token}',\n    }\n\n    status_url = status_url\n    response = requests.get(status_url, headers=headers)\n    response.raise_for_status()\n    return response.json()\n")),(0,o.mdx)("p",null,"JavaScript"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"async function checkJobStatus(status_url, accessToken) {\n  const headers = {\n    'Content-Type': 'application/json',\n    Accept: 'application/json',\n    'x-api-key': process.env.CUSTOM_MODELS_CLIENT_ID,\n    Authorization: `Bearer ${accessToken}`,\n  };\n\n  const response = await axios.get(status_url, { headers: headers });\n  return response.data;\n}\n")),(0,o.mdx)("h2",{id:"implementation-example"},"Implementation example"),(0,o.mdx)("p",null,"Review the full implementation example below to learn more."),(0,o.mdx)("p",null,"You'll need to ",(0,o.mdx)("a",{parentName:"p",href:"#set-up-your-environment"},"set up your environment")," before running this code."),(0,o.mdx)(p,{variant:"warning",slots:"header, text",mdxType:"InlineAlert"}),(0,o.mdx)("p",null,"Example code is NOT production ready"),(0,o.mdx)("p",null,"Because this code is for educational purposes only, it IS NOT production-ready and requires additional error handling, logging, and security measures before it can be used in a live application."),(0,o.mdx)(d,{slots:"heading, code",repeat:"2",languages:"Python, JavaScript",mdxType:"CodeBlock"}),(0,o.mdx)("p",null,"Python"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-python"},"import os\nimport time\nimport requests\nimport sys\n\nclient_id = os.environ['CUSTOM_MODELS_CLIENT_ID']\nclient_secret = os.environ['CUSTOM_MODELS_CLIENT_SECRET']\n\ndef retrieve_access_token():\n    token_url = 'https://ims-na1.adobelogin.com/ims/token/v3'\n\n    payload = {\n        'grant_type': 'client_credentials',\n        'client_id': client_id,\n        'client_secret': client_secret,\n        'scope': 'openid,AdobeID,firefly_api,ff_apis'\n    }\n\n    response = requests.post(token_url, data=payload)\n    response.raise_for_status()\n    token_data = response.json()\n    print(\"Access Token Retrieved\")\n    return token_data['access_token']\n\ndef list_custom_models(access_token):\n    url = 'https://firefly-api.adobe.io/v3/custom-models'\n    headers = {\n        'Authorization': f'Bearer {access_token}',\n        'x-api-key': os.environ['CUSTOM_MODELS_CLIENT_ID'],\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n    }\n\n    response = requests.get(url, headers=headers)\n    response.raise_for_status()\n    models_response = response.json()\n    print(\"List Custom Models Response:\", models_response)\n    return models_response\n\ndef generate_image_async(access_token, custom_model_id):\n    url = 'https://firefly-api.adobe.io/v3/images/generate-async'\n    headers = {\n        'Accept': 'application/json',\n        'Authorization': f'Bearer {access_token}',\n        'Content-Type': 'application/json',\n        'x-accept-mimetype': 'image/jpeg',\n        'x-model-version':'image3_custom',\n        'x-api-key': os.environ['CUSTOM_MODELS_CLIENT_ID'],\n    }\n\n    data = {\n        \"numVariations\": 2,\n        \"seeds\": [66080, 82683],\n        \"size\": {\"width\": 2048, \"height\": 2048},\n        \"prompt\": \"Laika running over rolling green hills with a big vibrant sun in the background\",\n        \"negativePrompt\": \"red\",\n        \"contentClass\": \"photo\",\n        \"visualIntensity\": 6,\n        \"style\": {\n            \"presets\": [\"painting\"],\n            \"strength\": 50\n        },\n        \"promptBiasingLocaleCode\": \"en-US\",\n        \"customModelId\": custom_model_id\n    }\n\n    response = requests.post(url, headers=headers, json=data)\n    response.raise_for_status()\n    result = response.json()\n    print(\"Generate Image Async Response:\", result)\n\n    status_url = result.get('statusUrl')\n    if not status_url:\n        print(\"No status_url returned. Cannot poll status.\")\n        sys.exit(1)\n\n    return status_url\n\ndef check_job_status(status_url, access_token):\n    headers = {\n        'Content-Type': 'application/json',\n        'Accept': 'application/json',\n        'x-api-key': os.environ['CUSTOM_MODELS_CLIENT_ID'],\n        'Authorization': f'Bearer {access_token}',\n    }\n\n    try:\n        status = 'running'\n        while status not in ['succeeded', 'failed']:\n            time.sleep(5)  # Wait for 5 seconds before checking status again\n            response = requests.get(status_url, headers=headers)\n            response.raise_for_status()\n            status_response = response.json()\n            status = status_response.get('status', 'unknown')\n            print(f'Job Status: {status}')\n\n        if status == 'succeeded':\n            print('Image generation completed successfully!')\n            print('Check the returned response for the image URLs or artifacts.')\n        else:\n            print('Image generation failed.')\n\n    except requests.exceptions.RequestException as error:\n        error_message = error.response.text if error.response else str(error)\n        print('Error checking job status:', error_message)\n        sys.exit(1)\n\ndef main():\n    # Step 1: Retrieve Access Token\n    access_token = retrieve_access_token()\n\n    # Step 2: List Custom Models\n    models_response = list_custom_models(access_token)\n\n    if models_response and 'custom_models' in models_response and len(models_response['custom_models']) > 0:\n        # Select the first model\n        custom_model_id = models_response['custom_models'][0].get('repo:assetId')\n        print(\"Using Custom Model ID:\", custom_model_id)\n    else:\n        print(\"No custom models found.\")\n        sys.exit(1)\n\n    # Step 3: Generate Image (Async)\n    status_url = generate_image_async(access_token, custom_model_id)\n\n    # Step 4: Poll Job Status\n    check_job_status(status_url, access_token)\n\nif __name__ == '__main__':\n    main()\n")),(0,o.mdx)("p",null,"JavaScript"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},'const axios = require(\'axios\');\nconst qs = require(\'qs\');\nconst process = require(\'process\');\n\n(async () => {\n  try {\n    // Step 1: Retrieve Access Token\n    const accessToken = await retrieveAccessToken();\n    console.log("Access Token Retrieved");\n\n    // Step 2: List Custom Models\n    const modelsResponse = await listCustomModels(accessToken);\n    if (modelsResponse && modelsResponse.custom_models && modelsResponse.custom_models.length > 0) {\n      // Select the first model\n      const customModelId = modelsResponse.custom_models[0][\'repo:assetId\'];\n      console.log("Using Custom Model ID:", customModelId);\n\n      // Step 3: Generate Image (Async)\n      const statusUrl = await generateImageAsync(accessToken, customModelId);\n      if (!statusUrl) {\n        console.log("No status_url returned. Cannot poll status.");\n        process.exit(1);\n      }\n\n      // Step 4: Poll Job Status\n      await checkJobStatus(statusUrl, accessToken);\n    } else {\n      console.log("No custom models found.");\n      process.exit(1);\n    }\n  } catch (error) {\n    console.error("An error occurred:", error.response?.data || error.message || error);\n    process.exit(1);\n  }\n})();\n\nasync function retrieveAccessToken() {\n  const data = qs.stringify({\n    grant_type: "client_credentials",\n    client_id: process.env.CUSTOM_MODELS_CLIENT_ID,\n    client_secret: process.env.CUSTOM_MODELS_CLIENT_SECRET,\n    scope: "openid,AdobeID,firefly_api,ff_apis",\n  });\n\n  const config = {\n    method: "post",\n    url: "https://ims-na1.adobelogin.com/ims/token/v3",\n    headers: { "Content-Type": "application/x-www-form-urlencoded" },\n    data: data,\n  };\n\n  const response = await axios.request(config);\n  return response.data.access_token;\n}\n\nasync function listCustomModels(accessToken) {\n  const config = {\n    method: "get",\n    url: "https://firefly-api.adobe.io/v3/custom-models",\n    headers: {\n      "Authorization": `Bearer ${accessToken}`,\n      "x-api-key": process.env.CUSTOM_MODELS_CLIENT_ID,\n      "Accept": "application/json",\n      "Content-Type": "application/json"\n    },\n  };\n\n  const response = await axios.request(config);\n  console.log("List Custom Models Response:", response.data);\n  return response.data;\n}\n\nasync function generateImageAsync(accessToken, customModelId) {\n  const config = {\n    method: "post",\n    url: "https://firefly-api.adobe.io/v3/images/generate-async",\n    headers: {\n      "Accept": "application/json",\n      "Authorization": `Bearer ${accessToken}`,\n      "Content-Type": "application/json",\n      "x-accept-mimetype": "image/jpeg",\n      "x-model-version": "image3_custom",\n      "x-api-key": process.env.CUSTOM_MODELS_CLIENT_ID,\n    },\n    data: JSON.stringify({\n      "numVariations": 2,\n      "seeds": [66080, 82683],\n      "size": { "width": 2048, "height": 2048 },\n      "prompt": "Laika running over rolling green hills with a big vibrant sun in the background",\n      "negativePrompt": "red",\n      "contentClass": "photo",\n      "visualIntensity": 6,\n      "style": {\n        "presets": ["painting"],\n        "strength": 50\n      },\n      "promptBiasingLocaleCode": "en-US",\n      "customModelId": customModelId\n    })\n  };\n\n  const response = await axios.request(config);\n  console.log("Generate Image Async Response:", response.data);\n  return response.data.statusUrl;\n}\n\nasync function checkJobStatus(statusUrl, accessToken) {\n  const headers = {\n    \'Content-Type\': \'application/json\',\n    \'Accept\': \'application/json\',\n    \'x-api-key\': process.env.CUSTOM_MODELS_CLIENT_ID,\n    \'Authorization\': `Bearer ${accessToken}`,\n  };\n\n  let status = \'running\';\n  try {\n    while (status !== \'succeeded\' && status !== \'failed\') {\n      // Wait 5 seconds before polling again\n      await new Promise(resolve => setTimeout(resolve, 5000));\n      const response = await axios.get(statusUrl, { headers });\n      status = response.data.status || \'unknown\';\n      console.log(`Job Status: ${status}`);\n    }\n\n    if (status === \'succeeded\') {\n      console.log(\'Image generation completed successfully!\');\n      console.log(\'Check the returned response for the image URLs or artifacts.\');\n    } else {\n      console.log(\'Image generation failed.\');\n    }\n  } catch (error) {\n    const errorMessage = error.response?.data || error.message || error;\n    console.log(\'Error checking job status:\', errorMessage);\n    process.exit(1);\n  }\n}\n\n')),(0,o.mdx)("h2",{id:"deepen-your-understanding"},"Deepen your understanding"),(0,o.mdx)("p",null,"Now that you have a working implementation, visit the ",(0,o.mdx)("a",{parentName:"p",href:"../../api/image_generation/V3/"},"reference documentation for the Generate Image API")," to explore more advanced use cases and automate your workflows."))}g.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-firefly-api-guides-how-tos-cm-generate-image-index-md-4578c6007dfe5ddb0598.js.map