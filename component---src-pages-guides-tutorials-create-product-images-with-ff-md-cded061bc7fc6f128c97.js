"use strict";(self.webpackChunkdev_site_documentation_template=self.webpackChunkdev_site_documentation_template||[]).push([[478],{26800:function(e,t,n){n.r(t),n.d(t,{_frontmatter:function(){return p},default:function(){return c}});var a=n(58168),o=n(80045),s=(n(88763),n(15680)),r=n(83407);const i=["components"],p={},d={_frontmatter:p},l=r.A;function c(e){let{components:t}=e,n=(0,o.A)(e,i);return(0,s.mdx)(l,(0,a.A)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,s.mdx)("h1",{id:"creating-product-images-at-scale-with-firefly-services"},"Creating Product Images at Scale with Firefly Services"),(0,s.mdx)("p",null,"Discover how to generate images of different sizes, for various regional markets, and with different themes. Build workflows that combine product images, generative AI prompts, output sizes, and text copy translations to streamline content creation."),(0,s.mdx)("h2",{id:"overview"},"Overview"),(0,s.mdx)("p",null,"Firefly Services encompass many APIs that allow for robust and complex workflows. One of the most valuable workflows possible supports content creation at scale. As a marketer, you may need to generate product images for:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"Different sizes"),(0,s.mdx)("li",{parentName:"ul"},"Different regional markets"),(0,s.mdx)("li",{parentName:"ul"},"Different themes")),(0,s.mdx)("p",null,"And so forth. When combined with multiple different products, the amount of collateral that could be needed can number in the tens of thousands. Let's consider a hypothetical workflow that demonstrates these capabilities in action."),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"We start with a set of product images."),(0,s.mdx)("li",{parentName:"ul"},"We combine that with a set of generative AI prompts."),(0,s.mdx)("li",{parentName:"ul"},"We determine a list of desired output sizes."),(0,s.mdx)("li",{parentName:"ul"},"Finally, we have a set of text copy translations to accompany our output.")),(0,s.mdx)("p",null,"If we start with just three products but add two prompts, four sizes, and three translations, we need 3x2x4x3, or 72 different results. Let's look at what it would take to build such a workflow."),(0,s.mdx)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,s.mdx)("p",null,"Before attempting to run this demo yourself, you'll need a few things."),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"You will need a set of credentials for Firefly Services. You can get those ",(0,s.mdx)("a",{parentName:"li",href:"../get-started.md"},"here"),"."),(0,s.mdx)("li",{parentName:"ul"},"As part of the workflow, we use cloud storage to hold files the Photoshop API uses. For this demo, we used Dropbox, so you will need credentials to work with their API, including the app key, app secret, and refresh token. Python developers can find the Dropbox SDK ",(0,s.mdx)("a",{parentName:"li",href:"https://www.dropbox.com/developers/documentation/python"},"here"),"."),(0,s.mdx)("li",{parentName:"ul"},"The code with Dropbox does all of its work under one folder named ",(0,s.mdx)("inlineCode",{parentName:"li"},"FFProcess"),". This is conveniently set as a variable that can be modified. "),(0,s.mdx)("li",{parentName:"ul"},"This demo uses a few demo assets that will be described as the process is documented. Everything required to run this demo (minus credentials, of course) can be grabbed from this ",(0,s.mdx)("a",{parentName:"li",href:"/ff-services-docs/process.zip"},"zip file"),"."),(0,s.mdx)("li",{parentName:"ul"},"The code in this demo uses Python, but any programming language can work with the REST APIs.")),(0,s.mdx)("h2",{id:"the-workflow"},"The Workflow"),(0,s.mdx)("p",null,"Before digging into the code, let's break down the process."),(0,s.mdx)("ol",null,(0,s.mdx)("li",{parentName:"ol"},"Read Local Data Sets:",(0,s.mdx)("ul",{parentName:"li"},(0,s.mdx)("li",{parentName:"ul"},"Read product images."),(0,s.mdx)("li",{parentName:"ul"},"Define desired sizes."),(0,s.mdx)("li",{parentName:"ul"},"Read prompts from a text file."),(0,s.mdx)("li",{parentName:"ul"},"Read translations from a text file."))),(0,s.mdx)("li",{parentName:"ol"},"Get Access Token and Connect to Dropbox: ",(0,s.mdx)("ul",{parentName:"li"},(0,s.mdx)("li",{parentName:"ul"},"Obtain access token for Firefly Services."),(0,s.mdx)("li",{parentName:"ul"},"Connect to Dropbox using credentials."))),(0,s.mdx)("li",{parentName:"ol"},"Remove Background from Product Images: For each product image, remove the background."),(0,s.mdx)("li",{parentName:"ol"},"Generate Images Based on Prompts: For each prompt, generate an image."),(0,s.mdx)("li",{parentName:"ol"},"Expand Images to Desired Sizes: For each prompt-generated image, expand to the desired sizes."),(0,s.mdx)("li",{parentName:"ol"},"Use Photoshop API and PSD (Photoshop Document) template:",(0,s.mdx)("ul",{parentName:"li"},(0,s.mdx)("li",{parentName:"ul"},"For each language and product shot:",(0,s.mdx)("ul",{parentName:"li"},(0,s.mdx)("li",{parentName:"ul"},"Input resized images from step 5."),(0,s.mdx)("li",{parentName:"ul"},"Input product without background from step 3."),(0,s.mdx)("li",{parentName:"ul"},"Input text from prompts in the desired language from step 1.")))))),(0,s.mdx)("h2",{id:"step-1-importing-the-dependencies"},"Step 1: Importing the dependencies"),(0,s.mdx)("p",null,"Our script begins by importing the required dependencies and reading in our credentials from the local environment. "),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},"import os\nimport requests \nimport dropbox\nfrom dropbox.files import CommitInfo, WriteMode\nimport time \nfrom slugify import slugify\n\nff_client_id = os.environ.get('CLIENT_ID')\nff_client_secret = os.environ.get('CLIENT_SECRET')\ndb_refresh_token = os.environ.get('DROPBOX_REFRESH_TOKEN')\ndb_app_key = os.environ.get('DROPBOX_APP_KEY')\ndb_app_secret = os.environ.get('DROPBOX_APP_SECRET')\n")),(0,s.mdx)("p",null,"Next, we're going to set up a bunch of variables that the workflow will use:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'# Base folder to use in Dropbox \ndb_base_folder = "/FFProcess/"\n\n# The output sizes\nsizes = ["1024x1024","1792x1024","1408x1024","1024x1408"]\n\n# Prompts\nprompts = [line.rstrip() for line in open(\'input/prompts.txt\',\'r\')]\n\n# Languages and translations\nlangs = [line.rstrip() for line in open(\'input/translations.txt\',\'r\')]\nlanguages = []\nfor l in langs:\n    language,text = l.split(\',\')\n    languages.append({"language":language, "text":text})\n\n# Products sources from a set of images.\nproducts = os.listdir("input/products")\n')),(0,s.mdx)("p",null,"From the top:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"db_base_folder")," is used to supply a 'root' part of our cloud storage system that the code will use."),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"sizes")," is a hard-coded list of required sizes."),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"prompts")," is read from a local file. Here's how it looks in our sample:")),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre"},"placed on a futuristic table, blue orange and neon cyberpunk backgrounds, gradients, blurry background out of focus\nplaced on the floor of a modern discotheque spotlights, blurry background, out of focus\n")),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"langs")," is a set of language codes and translations, also read from a local file:")),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre"},"en,Awesome!\nfr,Fantastique!\nde,Geil!\n")),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("inlineCode",{parentName:"li"},"products")," is a list of files read from a subdirectory. Currently, we have three images of a product on a white background:")),(0,s.mdx)("p",null,(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"700px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"31.5625%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/b780e235aec20c79b75892fe84e1d9ff/5530d/products.webp 320w","/ff-services-docs/static/b780e235aec20c79b75892fe84e1d9ff/0c8fb/products.webp 640w","/ff-services-docs/static/b780e235aec20c79b75892fe84e1d9ff/84c6d/products.webp 700w"],sizes:"(max-width: 700px) 100vw, 700px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/b780e235aec20c79b75892fe84e1d9ff/dd4a7/products.png 320w","/ff-services-docs/static/b780e235aec20c79b75892fe84e1d9ff/0f09e/products.png 640w","/ff-services-docs/static/b780e235aec20c79b75892fe84e1d9ff/a27c6/products.png 700w"],sizes:"(max-width: 700px) 100vw, 700px",type:"image/png"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/b780e235aec20c79b75892fe84e1d9ff/a27c6/products.png",alt:"Three products, all bottles",title:"Three products, all bottles",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,s.mdx)("h2",{id:"step-2-connect-to-firefly-services-and-dropbox"},"Step 2: Connect to Firefly Services and Dropbox"),(0,s.mdx)("p",null,"As the rest of the code will need to access both Firefly and Dropbox, our code then needs to authenticate and get access tokens."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'# Connect to Firefly Services and Dropbox\ndbx = dropbox_connect(db_app_key, db_app_secret, db_refresh_token)\nff_access_token = getFFAccessToken(ff_client_id, ff_client_secret)\nprint("Connected to Firefly and Dropbox APIs.")\n')),(0,s.mdx)("p",null,"Both of these functions are defined earlier in the script. "),(0,s.mdx)("p",null,"For Dropbox, here's our method:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},"def dropbox_connect(app_key, app_secret, refresh_token):\n    try:\n        dbx = dropbox.Dropbox(app_key=app_key, app_secret=app_secret, oauth2_refresh_token=refresh_token)\n    except AuthError as e:\n        print('Error connecting to Dropbox with access token: ' + str(e))\n    return dbx\n")),(0,s.mdx)("p",null,"This is pretty much straight from the documentation for the ",(0,s.mdx)("a",{parentName:"p",href:"https://github.com/dropbox/dropbox-sdk-python"},"Dropbox Python SDK"),"."),(0,s.mdx)("p",null,"For Firefly Services, the method looks like so:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},"def getFFAccessToken(id, secret):\n    response = requests.post(f\"https://ims-na1.adobelogin.com/ims/token/v3?client_id={id}&client_secret={secret}&grant_type=client_credentials&scope=openid,AdobeID,firefly_enterprise,firefly_api,ff_apis\")\n    return response.json()['access_token']\n")),(0,s.mdx)("p",null,"The ",(0,s.mdx)("inlineCode",{parentName:"p"},"client_id")," and ",(0,s.mdx)("inlineCode",{parentName:"p"},"client_secret")," from our Firefly Services credentials are passed to the authentication endpoint and exchanged for an access token. The response includes other data, including the lifetime of the token, but for our needs, we just need the token. "),(0,s.mdx)("h2",{id:"step-3-specify-a-reference-image"},"Step 3: Specify a reference image"),(0,s.mdx)("p",null,"Later in our workflow, we will use a prompt to generate a new image. However, we also want that image to be based on a source image. This is one of the powerful ways the Firefly API lets you guide the content it creates. "),(0,s.mdx)("p",null,"By using the ",(0,s.mdx)("a",{parentName:"p",href:"/ff-services-docs/firefly-api/guides/api/upload_image.md"},"Upload image API")," endpoint, we can provide a source image for reference later. "),(0,s.mdx)("p",null,"Here's a utility method that wraps that endpoint:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'def uploadImage(path, id, token):\n    \n    with open(path,\'rb\') as file:\n\n        response = requests.post("https://firefly-api.adobe.io/v2/storage/image", data=file, headers = {\n            "X-API-Key":id, \n            "Authorization":f"Bearer {token}",\n            "Content-Type": "image/jpeg"\n        }) \n\n        # Simplify the return a bit... \n        return response.json()["images"][0]["id"]\n')),(0,s.mdx)("p",null,"Notice we're returning just the ID as that's all we'll need later. And here's how we call it from our script:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},"referenceImage = uploadImage('input/source_image.jpg', ff_client_id, ff_access_token)\n")),(0,s.mdx)("p",null,"For our workflow, here's our source:"),(0,s.mdx)("p",null,(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"600px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"66.5625%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/135644a59df542ba55aa275dbc52781a/5530d/source.webp 320w","/ff-services-docs/static/135644a59df542ba55aa275dbc52781a/411c4/source.webp 600w"],sizes:"(max-width: 600px) 100vw, 600px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/135644a59df542ba55aa275dbc52781a/8980b/source.jpg 320w","/ff-services-docs/static/135644a59df542ba55aa275dbc52781a/e224a/source.jpg 600w"],sizes:"(max-width: 600px) 100vw, 600px",type:"image/jpeg"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/135644a59df542ba55aa275dbc52781a/e224a/source.jpg",alt:"Source image",title:"Source image",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,s.mdx)("h2",{id:"step-4-remove-background-from-product-images-with-photoshop-api"},"Step 4: Remove background from product images with Photoshop API"),(0,s.mdx)("p",null,"Next up we need to take our source products and remove the background from each. The Photoshop API requires the use of cloud storage so this process will require three things:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"We need to upload our product to Dropbox"),(0,s.mdx)("li",{parentName:"ul"},"We need to create a 'readable' link for that resource, a way for the Photoshop API to read in the image."),(0,s.mdx)("li",{parentName:"ul"},"We need to create a 'writable' link to give to Photoshop such that when it's done, it can store the result.")),(0,s.mdx)("p",null,"Let's begin with code that loops over the products:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'# We use this to remember where are product images w/ the backgrounds are stored.\nrbProducts = {}\nfor product in products:\n    \n    # First, upload the source\n    dropbox_upload(f"input/products/{product}", f"{db_base_folder}input")\n\n    # Get a readable link for that\n    readableLink = dropbox_get_read_link(f"{db_base_folder}input/{product}")\n\n    # Make a link to upload the result \n    writableLink = dropbox_get_upload_link(f"{db_base_folder}knockout/{product}")\n\n    rbJob = createRemoveBackgroundJob(readableLink, writableLink, ff_client_id, ff_access_token)\n    result = pollJob(rbJob, ff_client_id, ff_access_token)\n\n    readableLink = dropbox_get_read_link(f"{db_base_folder}knockout/{product}")\n    rbProducts[product] = readableLink\n    # For now, we assume ok\n')),(0,s.mdx)("p",null,"For each product, we upload and create a link. As these methods just wrap calls to the Dropbox SDK we'll skip showing them here, but they are available in the full code below. Notice however we're storing the products in an ",(0,s.mdx)("inlineCode",{parentName:"p"},"input")," folder (beneath our base folder). To create the version without the background, we create a writeable link to the ",(0,s.mdx)("inlineCode",{parentName:"p"},"knockout")," folder. "),(0,s.mdx)("p",null,"Now that we have our product in the cloud storage, a link to that product, and a way to write the output, we can call the Photoshop ",(0,s.mdx)("a",{parentName:"p",href:"../../photoshop/api/photoshop_removeBackground.md"},"Remove Background API"),". This is done in a utility method that accepts both links and credential information:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'def createRemoveBackgroundJob(input, output, id, token):\n    \n    data = {\n        "input": {\n            "href":input, \n            "storage":"dropbox"\n        },\n        "output":{\n            "href":output, \n            "storage":"dropbox"\n        }\n    }\n    response = requests.post(f"https://image.adobe.io/sensei/cutout", headers = {"Authorization": f"Bearer {token}", "x-api-key": id }, json=data)\n    return response.json()\n')),(0,s.mdx)("p",null,"Photoshop API calls are asynchronous and you can see in the loop shown above, we call another method, ",(0,s.mdx)("inlineCode",{parentName:"p"},"pollJob"),", to check for completion:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'def pollJob(job, id, token):\n    jobUrl = job["_links"]["self"]["href"]\n    status = "" \n    while status != \'succeeded\' and status != \'failed\':\n\n        response = requests.get(jobUrl, headers = {"Authorization": f"Bearer {token}", "x-api-key": id })\n        json_response = response.json()\n\n        if "status" in json_response:\n            status = json_response["status"]\n        elif "status" in json_response["outputs"][0]:\n            status = json_response["outputs"][0]["status"]\n            \n        if status != \'succeeded\' and status != \'failed\':\n            time.sleep(3)\n        else:\n            return json_response\n')),(0,s.mdx)("p",null,"This method will loop until a successful response has been returned. There's a bit of conditional logic to handle the different kinds of jobs run by Photoshop (our workflow will be calling another shortly), and as stated, we're assuming successful responses. "),(0,s.mdx)("p",null,"Before moving on, note again the last two lines in the loop:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'readableLink = dropbox_get_read_link(f"{db_base_folder}knockout/{product}")\nrbProducts[product] = readableLink\n')),(0,s.mdx)("p",null,"Earlier our code made an empty Python object, ",(0,s.mdx)("inlineCode",{parentName:"p"},"rbProducts"),". The purpose of this is to create a collection of key/value pairs where the key represents a product and the value is a readable link to the version with the background removed."),(0,s.mdx)("p",null,"One additional thing we do before moving on to Firefly is to create a readable link to our Photoshop template. This is already on Dropbox so we just need to get that link:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'# I\'m using this later when generating final results.\npsdOnDropbox = dropbox_get_read_link(f"{db_base_folder}genfill-banner-template-text-comp.psd")\n')),(0,s.mdx)("h2",{id:"step-5-generate-and-expand-images-using-firefly-api"},"Step 5: Generate and expand images using Firefly API"),(0,s.mdx)("p",null,"Now we're beginning a rather large and complex loop, so we'll try to take it bit by bit. Don't forget the complete script may be found at the end of the article."),(0,s.mdx)("h3",{id:"generate-images-based-on-prompts"},"Generate images based on prompts"),(0,s.mdx)("p",null,"First, we loop over each prompt (remember, this was sourced from a text file);"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},"for prompt in prompts:\n")),(0,s.mdx)("p",null,"Next, we generate an image for our prompt:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'    print(f"Generating an image with prompt: {prompt}.")\n    newImage = textToImage(prompt, referenceImage, ff_client_id, ff_access_token)\n')),(0,s.mdx)("p",null,"Let's look at ",(0,s.mdx)("inlineCode",{parentName:"p"},"textToImage"),":"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'def textToImage(text, imageId, id, token):\n\n    data = {\n        "numVariations":1,\n        "prompt":text,\n        "contentClass":"photo",\n        "size":{\n            "width":1024,\n            "height":1024\n        },\n        "style":{\n            "imageReference":{\n                "source":{\n                    "uploadId":imageId\n                }\n            }\n        }\n    }\n\n    response = requests.post("https://firefly-api.adobe.io/v3/images/generate", json=data, headers = {\n        "X-API-Key":id, \n        "Authorization":f"Bearer {token}",\n        "Content-Type":"application/json"\n    }) \n\n    return response.json()["outputs"][0]["image"]["url"]\n')),(0,s.mdx)("p",null,"This method is passed two main arguments (ignoring the credentials) - ",(0,s.mdx)("inlineCode",{parentName:"p"},"text")," and ",(0,s.mdx)("inlineCode",{parentName:"p"},"imageId"),", representing our prompt and reference image. You can see in ",(0,s.mdx)("inlineCode",{parentName:"p"},"data")," where these values are passed in. Finally, this is passed to the Firefly ",(0,s.mdx)("a",{parentName:"p",href:"../../firefly-api/guides/api/image_generation/V3/"},"Generate Images API")," API endpoint. The result, in this case the URL of the image, is returned. "),(0,s.mdx)("h3",{id:"expand-images-to-desired-sizes"},"Expand images to desired sizes"),(0,s.mdx)("p",null,"After generating the image for the prompt, we then need to resize it once for each of our desired sizes. If you remember, our sizes were:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'sizes = ["1024x1024","1792x1024","1408x1024","1024x1408"]\n')),(0,s.mdx)("p",null,"However, our initial image was 1024x1024, so we get to skip that when generating our new sizes. "),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'    # I store a key from size to the image\n    sizeImages = {}\n\n    for (idx, size) in enumerate(sizes):\n        # For each size, outside of our first, expand it\n        if idx >= 1:\n            print(f"Generating an expanded one at size {size}")\n            expandedBackground = generativeExpand(newImage, size, ff_client_id, ff_access_token)\n            sizeImages[size] = expandedBackground\n        else:\n            print(f"Using original for {size}")\n            sizeImages[size] = newImage\n')),(0,s.mdx)("p",null,"This code is using another utility method, ",(0,s.mdx)("inlineCode",{parentName:"p"},"generativeExpand"),":"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'def generativeExpand(imageUrl, size, id, token):\n\n    width, height = size.split(\'x\')\n\n    data = {\n        "numVariations":1,\n        "image":{\n            "source":{\n                "url":imageUrl\n            }\n        },\n        "size":{\n            "width":width, \n            "height":height\n        }\n    }\n\n    response = requests.post("https://firefly-api.adobe.io/v3/images/expand", json=data, headers = {\n        "X-API-Key":id, \n        "Authorization":f"Bearer {token}",\n        "Content-Type":"application/json"\n    })\n\n    return response.json()["outputs"][0]["image"]["url"]\n')),(0,s.mdx)("p",null,"This method wraps the ",(0,s.mdx)("a",{parentName:"p",href:"../../firefly-api/guides/api/generative_expand/V3/"},"Generative Expand API"),". It needs both the image resource to expand (which we got from the initial Generate Image API prompt) and the desired size. In this case, we need a link to the result so the URL is returned."),(0,s.mdx)("p",null,'As an example, given the prompt "placed on a futuristic table, blue orange and neon cyberpunk backgrounds, gradients, blurry background out of focus", the original Firefly generated image was expanded for all four sizes. Here are two examples:'),(0,s.mdx)("p",null,(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1024px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"137.5%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/ff84f75381d5bd561c6dd6fddc422c96/5530d/expand1.webp 320w","/ff-services-docs/static/ff84f75381d5bd561c6dd6fddc422c96/0c8fb/expand1.webp 640w","/ff-services-docs/static/ff84f75381d5bd561c6dd6fddc422c96/d71bc/expand1.webp 1024w"],sizes:"(max-width: 1024px) 100vw, 1024px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/ff84f75381d5bd561c6dd6fddc422c96/dd4a7/expand1.png 320w","/ff-services-docs/static/ff84f75381d5bd561c6dd6fddc422c96/0f09e/expand1.png 640w","/ff-services-docs/static/ff84f75381d5bd561c6dd6fddc422c96/42a19/expand1.png 1024w"],sizes:"(max-width: 1024px) 100vw, 1024px",type:"image/png"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/ff84f75381d5bd561c6dd6fddc422c96/42a19/expand1.png",alt:"One example of the expanded image",title:"One example of the expanded image",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    "),"\n",(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"1280px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"57.1875%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/7649981fa44c551c87631225eb173c59/5530d/expand2.webp 320w","/ff-services-docs/static/7649981fa44c551c87631225eb173c59/0c8fb/expand2.webp 640w","/ff-services-docs/static/7649981fa44c551c87631225eb173c59/94b1e/expand2.webp 1280w","/ff-services-docs/static/7649981fa44c551c87631225eb173c59/a4772/expand2.webp 1792w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/7649981fa44c551c87631225eb173c59/dd4a7/expand2.png 320w","/ff-services-docs/static/7649981fa44c551c87631225eb173c59/0f09e/expand2.png 640w","/ff-services-docs/static/7649981fa44c551c87631225eb173c59/bbbf7/expand2.png 1280w","/ff-services-docs/static/7649981fa44c551c87631225eb173c59/445c6/expand2.png 1792w"],sizes:"(max-width: 1280px) 100vw, 1280px",type:"image/png"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/7649981fa44c551c87631225eb173c59/bbbf7/expand2.png",alt:"Another example of the expanded image",title:"Another example of the expanded image",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,s.mdx)("h2",{id:"step-6-generate-final-product-images"},"Step 6: Generate final product images"),(0,s.mdx)("p",null,"We're almost there! Remember that we're inside a loop based on our prompt. We generated a new image based on the prompt and then expanded it to a list of sizes. The final section of the workflow will do the following:"),(0,s.mdx)("p",null,"We will reference a Photoshop template for cloud storage as a one-time operation. This PSD has four different blocks that match up with our desired sizes. It has layers for the products in each desired size and a text layer with default text. Here's how that PSD:"),(0,s.mdx)("p",null,(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"800px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"86.5625%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/e02a34e9dc08351c71bf6cd298df7bf5/5530d/psd.webp 320w","/ff-services-docs/static/e02a34e9dc08351c71bf6cd298df7bf5/0c8fb/psd.webp 640w","/ff-services-docs/static/e02a34e9dc08351c71bf6cd298df7bf5/cf465/psd.webp 800w"],sizes:"(max-width: 800px) 100vw, 800px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/e02a34e9dc08351c71bf6cd298df7bf5/dd4a7/psd.png 320w","/ff-services-docs/static/e02a34e9dc08351c71bf6cd298df7bf5/0f09e/psd.png 640w","/ff-services-docs/static/e02a34e9dc08351c71bf6cd298df7bf5/78d47/psd.png 800w"],sizes:"(max-width: 800px) 100vw, 800px",type:"image/png"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/e02a34e9dc08351c71bf6cd298df7bf5/78d47/psd.png",alt:"PSD template",title:"PSD template",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,s.mdx)("p",null,"The PSD was already uploaded to our Dropbox folder and we shared earlier in the tutorial the code to get the readable link."),(0,s.mdx)("p",null,"With that template in place, we can use the Photoshop API to dynamically replace the background, product, and text in each of the sized boxes. Here's that loop:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'    for lang in languages:\n        \n        for product in products:\n            \n            print(f\'Working with language {lang["language"]} and {product}\')\n\n            outputUrls = []\n\n            for size in sizes:\n                width, height = size.split(\'x\')\n                outputUrls.append(dropbox_get_upload_link(f"{db_base_folder}output/{lang[\'language\']}-{slugify(prompt)}-{slugify(product)}-{width}x{height}-{theTime}.jpg"))\n\n            result = createOutput(psdOnDropbox, rbProducts[product], sizes, sizeImages, outputUrls, lang["text"], ff_client_id, ff_access_token)\n            print("The Photoshop API job is being run...")\n            finalResult=pollJob(result, ff_client_id, ff_access_token)\n')),(0,s.mdx)("p",null,"Inside our two loops, we first have to figure out where the Photoshop API is going to save its results. For this, we create a link to a resource inside the ",(0,s.mdx)("inlineCode",{parentName:"p"},"output")," folder of our Dropbox storage that contains:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"The current language"),(0,s.mdx)("li",{parentName:"ul"},"The current prompt"),(0,s.mdx)("li",{parentName:"ul"},"The current product"),(0,s.mdx)("li",{parentName:"ul"},"The size"),(0,s.mdx)("li",{parentName:"ul"},"And the time (the variable ",(0,s.mdx)("inlineCode",{parentName:"li"},"theTime")," was set earlier in our script and simply references the current date and time)")),(0,s.mdx)("p",null,"This data is stored in an array, ",(0,s.mdx)("inlineCode",{parentName:"p"},"outputUrls"),". We can then call our method, ",(0,s.mdx)("inlineCode",{parentName:"p"},"createOutput"),", passing:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"The reference to the PSD shown earlier"),(0,s.mdx)("li",{parentName:"ul"},"The readable link of the product with the background removed"),(0,s.mdx)("li",{parentName:"ul"},"Our sizes"),(0,s.mdx)("li",{parentName:"ul"},"The resized generatively expanded images"),(0,s.mdx)("li",{parentName:"ul"},"Our desired output"),(0,s.mdx)("li",{parentName:"ul"},"The text to use in the text layer"),(0,s.mdx)("li",{parentName:"ul"},"And credentials of course.")),(0,s.mdx)("p",null,"Let's look at that method:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'def createOutput(psd, koProduct, sizes, sizeUrls, outputs, text, id, token):\n\n    data = {\n        "inputs": [{\n            "href":psd, \n            "storage":"dropbox"\n        }],\n        "options":{\n            "layers":[\n            ]\n        },\n        "outputs":[]\n    }\n\n    for (x,size) in enumerate(sizes):\n        width, height = size.split(\'x\')\n        url = sizeUrls[size]\n        data["options"]["layers"].append({\n            "name":f"{width}x{height}-text",\n            "edit":{},\n            "text":{\n                "content":text\n            }\n        })\n\n        data["options"]["layers"].append({\n            "name":f"{width}x{height}-background",\n            "edit":{},\n            "input":{\n                "storage":"external", \n                "href":url\n            }\n        })\n\n        data["options"]["layers"].append({\n            "name":f"{width}x{height}-product",\n            "edit":{},\n            "input":{\n                "storage":"external", \n                "href":koProduct\n            }\n        })\n\n        data["outputs"].append({\n            "href":outputs[x], \n            "storage":"dropbox",\n            "type":"image/jpeg",\n            "trimToCanvas":True,\n            "layers":[{\n                "name":f"{width}x{height}"\n            }]\n    \n        })\n\n    response = requests.post(f"https://image.adobe.io/pie/psdService/documentOperations", headers = {"Authorization": f"Bearer {token}", "x-api-key": id }, json=data)\n    return response.json()\n')),(0,s.mdx)("p",null,"This is a reasonably hefty method. As a whole, this code wraps calls to the ",(0,s.mdx)("a",{parentName:"p",href:"../../photoshop/api/photoshop_applyPsdEdits.md"},"Apply PSD Edits")," Photoshop API. "),(0,s.mdx)("p",null,"It creates a reasonably large JSON object that includes information on the new images for backgrounds and products. "),(0,s.mdx)("p",null,"It also passes information about the text layers. Lastly, it adds a set of output values that map to the ",(0,s.mdx)("inlineCode",{parentName:"p"},"sized")," layers containing our results. What's incredible is that all of this is handled in a straightforward call while generating multiple results. "),(0,s.mdx)("p",null,"As mentioned earlier, each run of this process should create 72 unique images. Here's one set of four sizes for one product, prompt, and language:"),(0,s.mdx)("p",null,(0,s.mdx)("span",{parentName:"p",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"957px"}},"\n      ",(0,s.mdx)("span",{parentName:"span",className:"gatsby-resp-image-background-image",style:{paddingBottom:"59.06250000000001%",position:"relative",bottom:"0",left:"0",display:"block",transition:"opacity 0.5s 0.5s",pointerEvents:"none"}}),"\n  ",(0,s.mdx)("picture",{parentName:"span"},"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/efb90e62af7107b5dcf6525ec624a9e2/5530d/result1.webp 320w","/ff-services-docs/static/efb90e62af7107b5dcf6525ec624a9e2/0c8fb/result1.webp 640w","/ff-services-docs/static/efb90e62af7107b5dcf6525ec624a9e2/20358/result1.webp 957w"],sizes:"(max-width: 957px) 100vw, 957px",type:"image/webp"}),"\n          ",(0,s.mdx)("source",{parentName:"picture",srcSet:["/ff-services-docs/static/efb90e62af7107b5dcf6525ec624a9e2/dd4a7/result1.png 320w","/ff-services-docs/static/efb90e62af7107b5dcf6525ec624a9e2/0f09e/result1.png 640w","/ff-services-docs/static/efb90e62af7107b5dcf6525ec624a9e2/f937e/result1.png 957w"],sizes:"(max-width: 957px) 100vw, 957px",type:"image/png"}),"\n          ",(0,s.mdx)("img",{parentName:"picture",className:"gatsby-resp-image-image",src:"/ff-services-docs/static/efb90e62af7107b5dcf6525ec624a9e2/f937e/result1.png",alt:"Result",title:"Result",loading:"lazy",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",opacity:"0",transition:"opacity 0.5s",color:"inherit",boxShadow:"inset 0px 0px 0px 400px none",top:"0",left:"0"}}),"\n        "),"\n    ")),(0,s.mdx)("h2",{id:"wrap-up"},"Wrap Up"),(0,s.mdx)("p",null,"What you've seen here is a fairly complex, but absolutely realistic example of the kind of workflows that Firefly Services can help organizations with. Generating marketing images at scale can save a tremendous amount of time and cost. Here's the complete script:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},'import os\nimport requests \nimport dropbox\nfrom dropbox.files import CommitInfo, WriteMode\nimport time \nfrom slugify import slugify\n\nff_client_id = os.environ.get(\'CLIENT_ID\')\nff_client_secret = os.environ.get(\'CLIENT_SECRET\')\ndb_refresh_token = os.environ.get(\'DROPBOX_REFRESH_TOKEN\')\ndb_app_key = os.environ.get(\'DROPBOX_APP_KEY\')\ndb_app_secret = os.environ.get(\'DROPBOX_APP_SECRET\')\n\n# Base folder to use in Dropbox \ndb_base_folder = "/FFProcess/"\n\n# The output sizes\nsizes = ["1024x1024","1792x1024","1408x1024","1024x1408"]\n\n# Prompts\nprompts = [line.rstrip() for line in open(\'input/prompts.txt\',\'r\')]\n\n# Languages and translations\nlangs = [line.rstrip() for line in open(\'input/translations.txt\',\'r\')]\nlanguages = []\nfor l in langs:\n    language,text = l.split(\',\')\n    languages.append({"language":language, "text":text})\n\n# Products sources from a set of images.\nproducts = os.listdir("input/products")\n\ndef createRemoveBackgroundJob(input, output, id, token):\n    \n    data = {\n        "input": {\n            "href":input, \n            "storage":"dropbox"\n        },\n        "output":{\n            "href":output, \n            "storage":"dropbox"\n        }\n    }\n    response = requests.post(f"https://image.adobe.io/sensei/cutout", headers = {"Authorization": f"Bearer {token}", "x-api-key": id }, json=data)\n    return response.json()\n\ndef pollJob(job, id, token):\n    jobUrl = job["_links"]["self"]["href"]\n    status = "" \n    while status != \'succeeded\' and status != \'failed\':\n\n        response = requests.get(jobUrl, headers = {"Authorization": f"Bearer {token}", "x-api-key": id })\n        json_response = response.json()\n\n        if "status" in json_response:\n            status = json_response["status"]\n        elif "status" in json_response["outputs"][0]:\n            status = json_response["outputs"][0]["status"]\n            \n        if status != \'succeeded\' and status != \'failed\':\n            time.sleep(3)\n        else:\n            return json_response\n\ndef dropbox_connect(app_key, app_secret, refresh_token):\n    try:\n        dbx = dropbox.Dropbox(app_key=app_key, app_secret=app_secret, oauth2_refresh_token=refresh_token)\n    except AuthError as e:\n        print(\'Error connecting to Dropbox with access token: \' + str(e))\n    return dbx\n\ndef dropbox_upload(f, folder):\n        newName = folder + \'/\' + f.split(\'/\')[-1]\n        with open(f,\'rb\') as file:\n            dbx.files_upload(file.read(), newName)\n\ndef dropbox_get_read_link(path):\n    link = dbx.sharing_create_shared_link(path).url\n    return link.replace("dl=0","dl=1")\n\ndef dropbox_get_upload_link(path):\n    commit_info = CommitInfo(path=path, mode=WriteMode.overwrite)\n    return dbx.files_get_temporary_upload_link(commit_info).link\n\n\ndef getFFAccessToken(id, secret):\n    response = requests.post(f"https://ims-na1.adobelogin.com/ims/token/v3?client_id={id}&client_secret={secret}&grant_type=client_credentials&scope=openid,AdobeID,firefly_enterprise,firefly_api,ff_apis")\n    return response.json()[\'access_token\']\n\ndef createOutput(psd, koProduct, sizes, sizeUrls, outputs, text, id, token):\n\n    data = {\n        "inputs": [{\n            "href":psd, \n            "storage":"dropbox"\n        }],\n        "options":{\n            "layers":[\n            ]\n        },\n        "outputs":[]\n    }\n\n    for (x,size) in enumerate(sizes):\n        width, height = size.split(\'x\')\n        url = sizeUrls[size]\n        data["options"]["layers"].append({\n            "name":f"{width}x{height}-text",\n            "edit":{},\n            "text":{\n                "content":text\n            }\n        })\n\n        data["options"]["layers"].append({\n            "name":f"{width}x{height}-background",\n            "edit":{},\n            "input":{\n                "storage":"external", \n                "href":url\n            }\n        })\n\n        data["options"]["layers"].append({\n            "name":f"{width}x{height}-product",\n            "edit":{},\n            "input":{\n                "storage":"external", \n                "href":koProduct\n            }\n        })\n\n        data["outputs"].append({\n            "href":outputs[x], \n            "storage":"dropbox",\n            "type":"image/jpeg",\n            "trimToCanvas":True,\n            "layers":[{\n                "name":f"{width}x{height}"\n            }]\n    \n        })\n\n    response = requests.post(f"https://image.adobe.io/pie/psdService/documentOperations", headers = {"Authorization": f"Bearer {token}", "x-api-key": id }, json=data)\n    return response.json()\n\ndef uploadImage(path, id, token):\n    \n    with open(path,\'rb\') as file:\n\n        response = requests.post("https://firefly-api.adobe.io/v2/storage/image", data=file, headers = {\n            "X-API-Key":id, \n            "Authorization":f"Bearer {token}",\n            "Content-Type": "image/jpeg"\n        }) \n\n        # Simplify the return a bit... \n        return response.json()["images"][0]["id"]\n\n\ndef textToImage(text, imageId, id, token):\n\n    data = {\n        "numVariations":1,\n        "prompt":text,\n        "contentClass":"photo",\n        "size":{\n            "width":1024,\n            "height":1024\n        },\n        "style":{\n            "imageReference":{\n                "source":{\n                    "uploadId":imageId\n                }\n            }\n        }\n    }\n\n    response = requests.post("https://firefly-api.adobe.io/v3/images/generate", json=data, headers = {\n        "X-API-Key":id, \n        "Authorization":f"Bearer {token}",\n        "Content-Type":"application/json"\n    }) \n\n    return response.json()["outputs"][0]["image"]["url"]\n\ndef generativeExpand(imageUrl, size, id, token):\n\n    width, height = size.split(\'x\')\n\n    data = {\n        "numVariations":1,\n        "image":{\n            "source":{\n                "url":imageUrl\n            }\n        },\n        "size":{\n            "width":width, \n            "height":height\n        }\n    }\n\n    response = requests.post("https://firefly-api.adobe.io/v3/images/expand", json=data, headers = {\n        "X-API-Key":id, \n        "Authorization":f"Bearer {token}",\n        "Content-Type":"application/json"\n    })\n\n    return response.json()["outputs"][0]["image"]["url"]\n\n\n# Connect to Firefly Services and Dropbox\ndbx = dropbox_connect(db_app_key, db_app_secret, db_refresh_token)\nff_access_token = getFFAccessToken(ff_client_id, ff_client_secret)\nprint("Connected to Firefly and Dropbox APIs.")\n\nreferenceImage = uploadImage(\'input/source_image.jpg\', ff_client_id, ff_access_token)\nprint("Reference image uploaded.")\n\n# We use this to remember where are product images w/ the backgrounds are stored.\nrbProducts = {}\nfor product in products:\n    \n    # First, upload the source\n    dropbox_upload(f"input/products/{product}", f"{db_base_folder}input")\n\n    # Get a readable link for that\n    readableLink = dropbox_get_read_link(f"{db_base_folder}input/{product}")\n\n    # Make a link to upload the result \n    writableLink = dropbox_get_upload_link(f"{db_base_folder}knockout/{product}")\n\n    rbJob = createRemoveBackgroundJob(readableLink, writableLink, ff_client_id, ff_access_token)\n    result = pollJob(rbJob, ff_client_id, ff_access_token)\n\n    readableLink = dropbox_get_read_link(f"{db_base_folder}knockout/{product}")\n    rbProducts[product] = readableLink\n    # For now, we assume ok\n\n\n# I\'m using this later when generating final results.\npsdOnDropbox = dropbox_get_read_link(f"{db_base_folder}genfill-banner-template-text-comp.psd")\n\ntheTime = time.time()\nfor prompt in prompts:\n    \n    # For each prompt, generate a new background using prompt and reference\n    print(f"Generating an image with prompt: {prompt}.")\n    newImage = textToImage(prompt, referenceImage, ff_client_id, ff_access_token)\n\n    # I store a key from size to the image\n    sizeImages = {}\n\n    for (idx, size) in enumerate(sizes):\n        # For each size, outside of our first, expand it\n        if idx >= 1:\n            print(f"Generating an expanded one at size {size}")\n            expandedBackground = generativeExpand(newImage, size, ff_client_id, ff_access_token)\n            sizeImages[size] = expandedBackground\n        else:\n            print(f"Using original for {size}")\n            sizeImages[size] = newImage\n\n\n    for lang in languages:\n        \n        for product in products:\n            \n            print(f\'Working with language {lang["language"]} and {product}\')\n\n            outputUrls = []\n\n            for size in sizes:\n                width, height = size.split(\'x\')\n                outputUrls.append(dropbox_get_upload_link(f"{db_base_folder}output/{lang[\'language\']}-{slugify(prompt)}-{slugify(product)}-{width}x{height}-{theTime}.jpg"))\n\n            result = createOutput(psdOnDropbox, rbProducts[product], sizes, sizeImages, outputUrls, lang["text"], ff_client_id, ff_access_token)\n            print("The Photoshop API job is being run...")\n            finalResult=pollJob(result, ff_client_id, ff_access_token)\n\nprint("Done.")\n')))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-guides-tutorials-create-product-images-with-ff-md-cded061bc7fc6f128c97.js.map